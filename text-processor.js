// Emoji to ASCII emoticon/symbol mappings
const EMOJI_MAP = {
  '‚ù§Ô∏è': '<3',
  'üíô': '<3',
  'üíö': '<3',
  'üíõ': '<3',
  'üíú': '<3',
  'üñ§': '<3',
  'ü§ç': '<3',
  'üòÄ': ':)',
  'üòÉ': ':D',
  'üòÑ': ':D',
  'üòÅ': ':D',
  'üòä': ':)',
  'üòá': 'O:)',
  'üôÇ': ':)',
  'üôÉ': '(-:',
  'üòâ': ';)',
  'üòå': ':)',
  'üòç': '<3',
  'ü•∞': '<3',
  'üòò': ':*',
  'üòó': ':*',
  'üòô': ':*',
  'üòö': ':*',
  'üòã': ':P',
  'üòõ': ':P',
  'üòù': 'XP',
  'üòú': ';P',
  'ü§™': 'XP',
  'ü§®': ':\\',
  'üßê': 'o_O',
  'ü§ì': '8-)',
  'üòé': 'B-)',
  'ü•≥': ':D',
  'üòè': ':]',
  'üòí': '-_-',
  'üòû': ':(',
  'üòî': ':(',
  'üòü': ':(',
  'üòï': ':/',
  'üôÅ': ':(',
  '‚òπÔ∏è': ':(',
  'üò£': '>_<',
  'üòñ': '>_<',
  'üò´': 'D:',
  'üò©': 'D:',
  'ü•∫': ':(',
  'üò¢': ':\'(',
  'üò≠': 'T_T',
  'üò§': '>:(',
  'üò†': '>:(',
  'üò°': '>:(',
  'ü§¨': '#$%!',
  'üò±': 'D:',
  'üò®': 'D:',
  'üò∞': 'D:',
  'üò•': ':\'(',
  'üòì': '^^;',
  'ü§ó': ':)',
  'ü§î': '?_?',
  'ü§≠': ':x',
  'ü§´': ':x',
  'ü§•': ':L',
  'üò∂': ':|',
  'üòê': ':|',
  'üòë': '-_-',
  'üò¨': ':S',
  'üôÑ': '-_-',
  'üòØ': ':o',
  'üò¶': 'D:',
  'üòß': 'D:',
  'üòÆ': ':O',
  'üò≤': ':O',
  'ü•±': '-_-',
  'üò¥': 'zzZ',
  'ü§§': ':p~',
  'üò™': ':\'(',
  'üòµ': '@_@',
  'ü§ê': ':X',
  'ü•¥': '@_@',
  'ü§¢': 'X_X',
  'ü§Æ': 'X_X',
  'ü§ß': '>_<',
  'üò∑': ':-#',
  'ü§í': ':-#',
  'ü§ï': ':-#',
  'üëç': '+1',
  'üëé': '-1',
  'üëå': 'OK',
  '‚úåÔ∏è': 'V',
  'ü§û': 'X',
  'ü§ü': 'ILY',
  'ü§ò': '\\m/',
  'üëè': '*clap*',
  'üôå': '\\o/',
  'üëê': ':D',
  'ü§≤': ':)',
  'ü§ù': '*shake*',
  'üôè': '*pray*',
  '‚úçÔ∏è': '*write*',
  'üí™': '*flex*',
  'ü¶æ': '*flex*',
  'üéâ': '*party*',
  'üéä': '*party*',
  'üéà': 'o',
  'üéÅ': '[gift]',
  'üèÜ': '[trophy]',
  'ü•á': '#1',
  'ü•à': '#2',
  'ü•â': '#3',
  '‚≠ê': '*',
  'üåü': '*',
  '‚ú®': '*~*',
  'üí´': '*',
  'üî•': '(fire)',
  'üí•': '*BOOM*',
  'üí¢': '!',
  'üíØ': '100',
  '‚úÖ': '[x]',
  '‚òëÔ∏è': '[x]',
  '‚úîÔ∏è': '[x]',
  '‚ùå': '[X]',
  '‚ùé': '[X]',
  '‚ö†Ô∏è': '/!\\',
  'üö´': '[NO]',
  'üí§': 'zzZ',
  'üí≠': '...',
  'üí¨': '...',
  'üó®Ô∏è': '...',
  'üóØÔ∏è': '!',
  'üí°': '(i)',
  'üîî': '*ding*',
  'üì¢': '>>',
  'üì£': '>>',
  'üéµ': '~',
  'üé∂': '~~',
  'üé§': '[mic]',
  'üì±': '[phone]',
  'üìß': '@',
  'üíå': '@',
  'üì®': '@',
  'üì©': '@',
  'üìÆ': '@',
  'üì™': '@',
  'üì¨': '@',
  'üì≠': '@',
  'üì´': '@',
  'üñ®Ô∏è': '[printer]',
  '‚å®Ô∏è': '[keyboard]',
  'üñ±Ô∏è': '[mouse]',
  'üñ•Ô∏è': '[pc]',
  'üíª': '[laptop]',
  '‚òï': '[coffee]',
  'üçï': '[pizza]',
  'üçî': '[burger]',
  'üçü': '[fries]',
  'üçø': '[popcorn]',
  'üç©': '[donut]',
  'üç™': '[cookie]',
  'üç∞': '[cake]',
  'üéÇ': '[cake]',
  'üç∫': '[beer]',
  'üçª': '[cheers]',
  'üç∑': '[wine]',
  'ü•Ç': '[cheers]',
  'üåÆ': '[taco]',
  'üåØ': '[burrito]',
  'ü•ó': '[salad]',
  'üçé': '[apple]',
  'üçä': '[orange]',
  'üçã': '[lemon]',
  'üçå': '[banana]',
  'üçâ': '[melon]',
  'üçá': '[grapes]',
  'üçì': '[berry]',
  'ü•ù': '[kiwi]',
  'üçë': '[peach]',
  'ü••': '[coconut]',
  'ü•ë': '[avocado]',
  'üçÜ': '[eggplant]',
  'ü•ï': '[carrot]',
  'üåΩ': '[corn]',
  'ü•í': '[pickle]',
  'ü•¶': '[broccoli]',
  'üßÑ': '[garlic]',
  'üßÖ': '[onion]',
  'üçÑ': '[mushroom]',
  'ü•ú': '[peanut]',
  'üå∞': '[nut]',
  'üçû': '[bread]',
  'ü•ê': '[croissant]',
  'ü•ñ': '[baguette]',
  'ü•®': '[pretzel]',
  'ü•Ø': '[bagel]',
  'üßÄ': '[cheese]',
  'ü•ö': '[egg]',
  'üç≥': '[cooking]',
  'ü•ì': '[bacon]',
  'ü•©': '[steak]',
  'üçó': '[chicken]',
  'üçñ': '[meat]',
  'ü¶¥': '[bone]',
  'üå≠': '[hotdog]',
  'üç±': '[bento]',
  'üçú': '[ramen]',
  'üçù': '[pasta]',
  'üçõ': '[curry]',
  'üç≤': '[stew]',
  'ü•ò': '[pan]',
  'üç£': '[sushi]',
  'üç§': '[shrimp]',
  'ü¶û': '[lobster]',
  'ü¶Ä': '[crab]',
  'üêô': '[octopus]',
  'ü¶ë': '[squid]',
  'üêö': '[shell]',
  'üç¶': '[icecream]',
  'üçß': '[shaved-ice]',
  'üç®': '[icecream]',
  'üçÆ': '[pudding]',
  'üç≠': '[candy]',
  'üç¨': '[candy]',
  'üç´': '[chocolate]',
  'üéÉ': '[pumpkin]',
  'üéÑ': '[tree]',
  'üéÜ': '[fireworks]',
  'üéá': '[sparkler]',
  'üß®': '[firecracker]',
  'üê∂': '[dog]',
  'üê±': '[cat]',
  'üê≠': '[mouse]',
  'üêπ': '[hamster]',
  'üê∞': '[rabbit]',
  'ü¶ä': '[fox]',
  'üêª': '[bear]',
  'üêº': '[panda]',
  'üê®': '[koala]',
  'üêØ': '[tiger]',
  'ü¶Å': '[lion]',
  'üêÆ': '[cow]',
  'üê∑': '[pig]',
  'üê∏': '[frog]',
  'üêµ': '[monkey]',
  'üôà': 'x_x',
  'üôâ': 'x_x',
  'üôä': 'x_x',
  'üêî': '[chicken]',
  'üêß': '[penguin]',
  'üê¶': '[bird]',
  'ü¶Ü': '[duck]',
  'ü¶Ö': '[eagle]',
  'ü¶â': '[owl]',
  'ü¶á': '[bat]',
  'üê∫': '[wolf]',
  'üêó': '[boar]',
  'üê¥': '[horse]',
  'ü¶Ñ': '[unicorn]',
  'üêù': '[bee]',
  'üêõ': '[bug]',
  'ü¶ã': '[butterfly]',
  'üêå': '[snail]',
  'üêû': '[ladybug]',
  'üêú': '[ant]',
  'üï∑Ô∏è': '[spider]',
  'üï∏Ô∏è': '[web]',
  'ü¶Ç': '[scorpion]',
  'üê¢': '[turtle]',
  'üêç': '[snake]',
  'ü¶é': '[lizard]',
  'ü¶ñ': '[dino]',
  'ü¶ï': '[dino]',
  'üêô': '[octopus]',
  'ü¶ë': '[squid]',
  'ü¶à': '[shark]',
  'üê≥': '[whale]',
  'üêã': '[whale]',
  'üê¨': '[dolphin]',
  'üêü': '[fish]',
  'üê†': '[fish]',
  'üê°': '[fish]',
  'ü¶ê': '[shrimp]',
  'ü¶û': '[lobster]',
  'ü¶Ä': '[crab]',
  'üêö': '[shell]',
  'üå∏': '[flower]',
  'üíê': '[bouquet]',
  'üåπ': '@-}--',
  'ü•Ä': '[wilted]',
  'üå∫': '[flower]',
  'üåª': '[sunflower]',
  'üåº': '[flower]',
  'üå∑': '[tulip]',
  'üå±': '[sprout]',
  'üå≤': '[tree]',
  'üå≥': '[tree]',
  'üå¥': '[palm]',
  'üåµ': '[cactus]',
  'üåæ': '[grain]',
  'üåø': '[herb]',
  '‚òòÔ∏è': '[clover]',
  'üçÄ': '[4leaf]',
  'üçÅ': '[leaf]',
  'üçÇ': '[leaf]',
  'üçÉ': '[leaf]',
  'üåç': '[earth]',
  'üåé': '[earth]',
  'üåè': '[earth]',
  'üåê': '[globe]',
  'üåë': 'o',
  'üåí': 'c',
  'üåì': '(',
  'üåî': '(',
  'üåï': 'O',
  'üåñ': ')',
  'üåó': ')',
  'üåò': 'c',
  'üåô': 'c',
  'üåö': 'o',
  'üåõ': 'c',
  'üåú': 'c',
  'üåù': 'O',
  '‚≠ê': '*',
  'üåü': '*',
  'üí´': '*',
  '‚ú®': '*~*',
  '‚òÄÔ∏è': '(sun)',
  'üåû': '(sun)',
  'üå§Ô∏è': '(sun)',
  '‚õÖ': '(cloud)',
  'üå•Ô∏è': '(cloud)',
  '‚òÅÔ∏è': '(cloud)',
  'üå¶Ô∏è': '(rain)',
  'üåßÔ∏è': '(rain)',
  '‚õàÔ∏è': '(storm)',
  'üå©Ô∏è': '(lightning)',
  'üå®Ô∏è': '(snow)',
  '‚ùÑÔ∏è': '*',
  '‚òÉÔ∏è': '[snowman]',
  '‚õÑ': '[snowman]',
  'üå¨Ô∏è': '~',
  'üí®': '~',
  'üå™Ô∏è': '[tornado]',
  'üå´Ô∏è': '~~~',
  'üåà': '[rainbow]',
  '‚òî': '[umbrella]',
  'üíß': '.',
  'üí¶': '..',
  'üåä': '~~~',
  'üî•': '(fire)',
  'üí•': '*BOOM*',
  '‚ö°': '!',
  '‚òÑÔ∏è': '*',
  'üí´': '*',
  'üå†': '*~',
  'üåå': '...',
  'üåÉ': '[city]',
  'üèôÔ∏è': '[city]',
  'üåÜ': '[sunset]',
  'üåá': '[sunrise]',
  'üåâ': '[bridge]',
  'üé†': '[carousel]',
  'üé°': '[ferris]',
  'üé¢': '[coaster]',
  'üöÄ': '[rocket]',
  'üõ∏': '[ufo]',
  'üöÅ': '[copter]',
  '‚úàÔ∏è': '[plane]',
  'üöÇ': '[train]',
  'üöÉ': '[train]',
  'üöÑ': '[train]',
  'üöÖ': '[train]',
  'üöÜ': '[train]',
  'üöá': '[metro]',
  'üöà': '[tram]',
  'üöâ': '[station]',
  'üöä': '[tram]',
  'üöù': '[mono]',
  'üöû': '[rail]',
  'üöã': '[tram]',
  'üöå': '[bus]',
  'üöç': '[bus]',
  'üöé': '[trolley]',
  'üöê': '[van]',
  'üöë': '[ambulance]',
  'üöí': '[fire-truck]',
  'üöì': '[police]',
  'üöî': '[police]',
  'üöï': '[taxi]',
  'üöñ': '[taxi]',
  'üöó': '[car]',
  'üöò': '[car]',
  'üöô': '[suv]',
  'üöö': '[truck]',
  'üöõ': '[truck]',
  'üöú': '[tractor]',
  'üèéÔ∏è': '[racecar]',
  'üèçÔ∏è': '[motorcycle]',
  'üõµ': '[scooter]',
  'üö≤': '[bike]',
  'üõ¥': '[scooter]',
  '‚öΩ': '[ball]',
  'üèÄ': '[basketball]',
  'üèà': '[football]',
  '‚öæ': '[baseball]',
  'ü•é': '[softball]',
  'üéæ': '[tennis]',
  'üèê': '[volleyball]',
  'üèâ': '[rugby]',
  'üé±': '[8ball]',
  'üèì': '[pingpong]',
  'üè∏': '[badminton]',
  'ü•Ö': '[goal]',
  'üèí': '[hockey]',
  'üèë': '[hockey]',
  'ü•ç': '[lacrosse]',
  'üèè': '[cricket]',
  'ü•ä': '[boxing]',
  'ü•ã': '[martial-arts]',
  '‚õ≥': '[golf]',
  'üèπ': '[archery]',
  'üé£': '[fishing]',
  'ü•è': '[frisbee]',
  'üõπ': '[skateboard]',
  'üõº': '[skate]',
  '‚õ∏Ô∏è': '[skate]',
  'üéø': '[ski]',
  '‚õ∑Ô∏è': '[ski]',
  'üèÇ': '[snowboard]',
  'üèãÔ∏è': '[lift]',
  'ü§∏': '[cartwheel]',
  '‚õπÔ∏è': '[ball]',
  'ü§æ': '[handball]',
  'üèåÔ∏è': '[golf]',
  'üßò': '[yoga]',
  'üèÉ': '[run]',
  'üö∂': '[walk]',
  'üßó': '[climb]',
  'üö¥': '[bike]',
  'üöµ': '[mountain-bike]',
  'ü§º': '[wrestle]',
  'ü§Ω': '[polo]',
  'ü§∫': '[fencing]',
  'üèá': '[horse-race]',
  '‚õ∑Ô∏è': '[ski]',
  'üèÇ': '[snowboard]',
  'üèÑ': '[surf]',
  'üö£': '[row]',
  'üèä': '[swim]',
  '‚õπÔ∏è': '[ball]',
  'üèãÔ∏è': '[lift]',
  'üö¥': '[bike]',
  'üöµ': '[bike]',
  'ü§∏': '[flip]',
  'ü§º': '[wrestle]',
  'ü§Ω': '[polo]',
  'ü§æ': '[handball]',
  'ü§π': '[juggle]',
  'üßò': '[yoga]',
  'üõÄ': '[bath]',
  'üõå': '[sleep]',
  'ü§ù': '*shake*',
};

// Convert emojis to ASCII emoticons
function convertEmojis(text) {
  let result = text;
  
  // Replace emojis with their ASCII equivalents
  for (const [emoji, ascii] of Object.entries(EMOJI_MAP)) {
    result = result.split(emoji).join(ascii);
  }
  
  // For any remaining emojis, try to extract the emoji name in brackets
  result = result.replace(/[\u{1F300}-\u{1F9FF}]/gu, (match) => {
    // If we don't have a mapping, just remove it or replace with ?
    return '[emoji]';
  });
  
  return result;
}

// Fix apostrophes and other special characters for thermal printer
function fixSpecialChars(text) {
  return text
    .replace(/'/g, "'")  // Smart apostrophe to straight
    .replace(/'/g, "'")  // Smart apostrophe to straight
    .replace(/"/g, '"')  // Smart quote to straight
    .replace(/"/g, '"')  // Smart quote to straight
    .replace(/‚Äì/g, '-')  // En dash to hyphen
    .replace(/‚Äî/g, '-')  // Em dash to hyphen
    .replace(/‚Ä¶/g, '...') // Ellipsis
    .replace(/‚Ñ¢/g, '(TM)')
    .replace(/¬Æ/g, '(R)')
    .replace(/¬©/g, '(C)')
    .replace(/¬∞/g, 'deg')
    .replace(/√ó/g, 'x')
    .replace(/√∑/g, '/')
    .replace(/¬±/g, '+/-')
    .replace(/‚â†/g, '!=')
    .replace(/‚âà/g, '~')
    .replace(/‚â§/g, '<=')
    .replace(/‚â•/g, '>=')
    .replace(/‚Üê/g, '<-')
    .replace(/‚Üí/g, '->')
    .replace(/‚Üë/g, '^')
    .replace(/‚Üì/g, 'v');
}

// Process text for thermal printing
function processText(text) {
  // First fix special characters
  let processed = fixSpecialChars(text);
  
  // Then convert emojis
  processed = convertEmojis(processed);
  
  // Ensure it's safe ASCII
  processed = processed.replace(/[^\x00-\x7F]/g, '?');
  
  return processed;
}

module.exports = {
  processText,
  convertEmojis,
  fixSpecialChars
};
